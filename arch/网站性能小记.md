> **前言**
>
> 一个网站系统，在上线之初往往可以快速打开，响应迅速；而运行几年之后，数据量无时无刻不在增长，业务持续的更新变化，页面打开速度往往低的吓人，更有甚者会造成服务宕机。运维人员不得不无奈的上调服务器配置，开发者不得不四处研究到底发生了什么。

# 1 从一条HTTP请求说起

超文本传输协议（HTTP，HyperText Transfer Protocol）是互联网上应用最为广泛的一种网络协议。属于OSI七层模型中的应用层。OSI七层模型从上到下分别为应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。

关于OSI七层模型，参看下图：

![](/say/code/book/ppt/hide_img/osi.gif)

除此之外，还有一种分层方法被称为TCP/IP四层模型，简而言之就是将七层合并为应用层、传输层、网络层、网络接口层。

说白了，HTTP只是一种协议，方便客户端与服务端进行交流的规范。

**请求**Request

```http
GET /index.php HTTP/1.1
Host: www.sanhao.com
Connection: keep-alive
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0(X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/65.0.3325.181 Chrome/65.0.3325.181 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Referer: http://www.baidu.com/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7,zh-TW;q=0.6
Cookie: uuid=1234567; PHPSESSID=abdcefg
If-Modified-Since: Tue, 17 Apr 2018 01:41:55 GMT

name=say&age=28&title=php&time=1234567890
```

**响应**Reponse

```http
HTTP/1.1 200 OK
Date: Tue, 17, Apr 2018 03:22:23 GMT
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
Vary: Accept-Encoding
Cache-Control: private, max-age=10
Expires: Tue, 17 Apr 2018 03:22:33 GMT
Last-modified: Tue, 17 Apr 2018 03:22:33 GMT
Content-Encoding: gzip

<!DOCTYPE html>
<html>
	<head>
		<title></title>
	</head>
	<body>
		<div id="main">Hello, World!</div>
	</body>
</html>
```

任何一个HTTP请求都分为请求头和请求体，GET方式请求体为空，头部会定义请求方式、URI、HTTP协议及协议使用版本，除此之外还会规定连接情况、客户端信息、Cookie、支持格式、编码格式、请求来源等。

响应头包含协议版本、状态码、返回信息、时间、连接方式、有效期、格式等，一般在响应体里面还会包含HTML代码。

# 2 计算机的时间概念

# 3 读与写

# 4 银弹“缓存”

# 5 异歩写入

# 6 MySQL

## 6.1 B+树与索引

## 6.2 数据库字段小TIP

## 6.3 慢查询

#7 复杂业务

## 7.1 查询压力

##7.2 数据冗余

##7.3 可维护性

# 8 结尾

