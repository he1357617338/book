#从很久很久以前

三好网初期的定位是一个电子商务网站，B2C、C2C或者说C2B2C。

所以库存(sku)和订单(order)、支付(pay)就是无论如何都绕不过去的问题了。

当然，因为是做在线教育的，所以方式方法上和传统的电子商务除了相似的地方外，页存在很多的区别

1. 商家，我们的商家是教师，类似于淘宝的店主
2. 商品，我们的商品是教师发布的课程，类似于淘宝店主贩售的商品
3. 库存，我们的库存是教师的可用时间，更类似于12306的车票，需要具有唯一性
4. 订单，我们的订单包含用户买了哪个教师的课时，花了多少钱，以及相关的状态
5. 子订单，我们的子订单是用户基于订单每一次预约课程的记录，以及教师上课的结算凭证
6. 状态，和传统电子商务的状态不同，我们的订单一般具有较长的时间周期，一个订单可能具有60、100小时的时长，用户需要连续上课长达一年之久才能完成一个订单，当然，也可以买一节上一节。

#并发点

在一般的网站业务中，并发读对于架构师来说，可能是一种很基本的需求。了解业务特性、业务并发点，对于我们如何来进行架构设计一个高可用高并发的系统来说是必需的。

这些并发的点只针对于用户选择老师、购买课程并支付这个“购物”流程；对于整个三好网来说，并发的点还有很多,但是“购物”这个流程基本上可以包含绝大多数的点，具备代表性。

##读

1. 教师工作室（我更愿意称之为教师详情页，包括教师信息、相关信息、评价信息、推荐信息、课程信息）
2. 教师可用时间片（库存）
3. 订单查询、课表查询（课表本质上是基于订单与子订单的不同显示）

针对教师详情页而言，基本上是一个读多写少的业务。而真对于并发读，我们要做的就是“缓存”。

1. NoSQL、文件缓存
2. PHP性能提升
3. 页面静态化
4. CDN
5. 浏览器缓存

对于三好网来说，我们使用Redis作为内存缓存，将API接口服务提供的返回结果直接使用KV进行存储，在接收到请求时，不是去读取数据库，而是直接从内存（数据库）中讲数据返回，从而提高并发能力。

Redis提供了一个共享缓存，无论我们有多少个API服务器，都可以共享一个Redis内存数据库，而API服务本身，则可以通过文件缓存来将返回结果存储到文件中。由于是文件操作系统，在第一次请求过来的时候，会直接将文件读入内存中，在操作系统内存充足的情况下，我们的缓存效率相当于内存数据库。

当然，PHP是解释性脚本语言，如果想要单台服务器能够承载更多的并发访问，我们接下来要做的事情有几种选择：APC（缓存opcode）、升级（PHP7的效率远远高于PHP5）、HHVM（PHP的类似于Java中JVM的）。无论是缓存opcode还是虚拟机，都会让PHP的最大优势（自由灵活）受到限制，而升级到PHP7，则对于公司技术部的运维配置、代码迁移成本和团队成员来说是一种不小的挑战（我们的开发人员实在是有点少-。-）。

所以，页面静态化对我们来说是一种很简单、便捷的缓存形式。说到静态化，大家想到的就是写页面、套模板、生成html。考虑到项目已经很庞大了、团队开发形式不能轻易改变（任何调整都需要一步步来，不然阻力真心很大）、传统的静态化方式（Smarty之类的）真心浪费PHP的优势。
